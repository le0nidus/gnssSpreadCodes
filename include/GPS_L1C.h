#include "Constellation.h"

constexpr int GPS_L1C_WEIL_N = 10223;
constexpr int GPS_L1C_PRIMARY_CODE_LENGTH = 10230;  // Each primary code of Pilot/Data components has the length 10230 chips.
constexpr int GPS_L1C_OVERLAY_CODE_LENGTH = 1800;  // Each overlay code L1CO has the length 1800 chips.

constexpr int GPS_L1C_NUM_REGISTERS_IN_LFSR = 11; // Amount of registers in the B2a primary codes
constexpr int GPS_L1C_TAPS_S2 = 1280;

constexpr int GPS_L1C_NUMBER_OF_SATS = 63;		      //Total number of satellites
constexpr int GPS_L1C_NUMBER_OF_CODES = 210;		      //Total number of codes available in the ICD

class GPS_L1C : public Constellation{
public:
    GPS_L1C() {     // Constructor
        residue = residueCalculator(GPS_L1C_WEIL_N);
        legendre = generateLegendreSequence(GPS_L1C_WEIL_N, residue);
    }

    void generateL1CD(int prn);
    void generateL1CP(int prn);
    void generateL1CO(int prn);

private:

    std::string getConstellationName() override { return "GPS L1C"; }
    int getNumberOfSats() override { return GPS_L1C_NUMBER_OF_CODES; }    

    std::vector<int> residue;
    std::vector<int> legendre;
    const std::vector<int> insertion_weilCode = {0, 1, 1, 0, 1, 0, 0};

    void generateWeilL1C(int w, int p);
    void generatePRN(int prn, std::vector<int> s1, int s1Taps);

    const int L1CP_weil_w[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 210
        5111, 5109, 5108, 5106, 5103, 5101, 5100, 5098, 5095, 5094, 5093, 5091,
        5090, 5081, 5080, 5069, 5068, 5054, 5044, 5027, 5026, 5014, 5004, 4980,
        4915, 4909, 4893, 4885, 4832, 4824, 4591, 3706, 5092, 4986, 4965, 4920,
        4917, 4858, 4847, 4790, 4770, 4318, 4126, 3961, 3790, 4911, 4881, 4827,
        4795, 4789, 4725, 4675, 4539, 4535, 4458, 4197, 4096, 3484, 3481, 3393,
        3175, 2360, 1852, 5065, 5063, 5055, 5012, 4981, 4952, 4934, 4932, 4786,
        4762, 4640, 4601, 4563, 4388, 3820, 3687, 5052, 5051, 5047, 5039, 5015,
        5005, 4984, 4975, 4974, 4972, 4962, 4913, 4907, 4903, 4833, 4778, 4721,
        4661, 4660, 4655, 4623, 4590, 4548, 4461, 4442, 4347, 4259, 4256, 4166,
        4155, 4109, 4100, 4023, 3998, 3979, 3903, 3568, 5088, 5050, 5020, 4990,
        4982, 4966, 4949, 4947, 4937, 4935, 4906, 4901, 4872, 4865, 4863, 4818,
        4785, 4781, 4776, 4775, 4754, 4696, 4690, 4658, 4607, 4599, 4596, 4530,
        4524, 4451, 4441, 4396, 4340, 4335, 4296, 4267, 4168, 4149, 4097, 4061,
        3989, 3966, 3789, 3775, 3622, 3523, 3515, 3492, 3345, 3235, 3169, 3157,
        3082, 3072, 3032, 3030, 4582, 4595, 4068, 4871, 4514, 4439, 4122, 4948,
        4774, 3923, 3411, 4745, 4195, 4897, 3047, 4185, 4354, 5077, 4042, 2111,
        4311, 5024, 4352, 4678, 5034, 5085, 3646, 4868, 3668, 4211, 2883, 2850,
        2815, 2542, 2492, 2376, 2036, 1920
    };
    
    const int L1CP_idx_p[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 210
         412,  161,     1,   303,   207,  4971, 4496,     5,  4557,  485,  253, 4676,
           1,   66,  4485,   282,   193,  5211,  729,  4848,   982, 5955, 9805,  670,
         464,   29,   429,   394,   616,  9457, 4429,  4771,   365, 9705, 9489, 4193,
        9947,  824,   864,   347,   677,  6544, 6312,  9804,   278, 9461,  444, 4839,
        4144, 9875,   197,  1156,  4674, 10035, 4504,     5,  9937,  430,    5,  355,
         909, 1622,  6284,  9429,    77,   932, 5973,   377, 10000,  951, 6212,  686,
        9352, 5999,  9912,  9620,   635,  4951, 5453,  4658,  4800,   59,  318,  571,
         565, 9947,  4654,   148,  3929,   293,  178, 10142,  9683,  137,  565,   35,
        5949,    2,  5982,   825,  9614,  9790, 5613,   764,   660, 4870, 4950, 4881,
        1151, 9977,  5122, 10074,  4832,    77, 4698,  1002,  5549, 9606, 9228,  604,
        4678, 4854,  4122,  9471,  5026,   272, 1027,   317,   691,  509, 9708, 5033,
        9938, 4314, 10140,  4790,  9823,  6093,  469,  1215,   799,  756, 9994, 4843,
        5271, 9661,  6255,  5203,   203, 10070,   30,   103,  5692,   32, 9826,   76,
          59, 6831,   958,  1471, 10070,   553, 5487,    55,   208,  645, 5268, 1873,
         427,  367,  1404,  5652,     5,   368,  451,  9595,  1030, 1324,  692, 9819,
        4520, 9911,   278,   642,  6330,  5508, 1872,  5445, 10131,  422, 4918,  787,
        9864, 9753,  9859,   328,     1,  4733, 164,    135,   174,  132,  538,  176,
         198,  595,   574,   321,   596,   491
    };
    
    const int L1CD_weil_w[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 63
        5097, 5110, 5079, 4403, 4121, 5043, 5042, 5104, 4940, 5035, 4372, 5064,
        5084, 5048, 4950, 5019, 5076, 3736, 4993, 5060, 5061, 5096, 4983, 4783,
        4991, 4815, 4443, 4769, 4879, 4894, 4985, 5056, 4921, 5036, 4812, 4838,
        4855, 4904, 4753, 4483, 4942, 4813, 4957, 4618, 4669, 4969, 5031, 5038,
        4740, 4073, 4843, 4979, 4867, 4964, 5025, 4579, 4390, 4763, 4612, 4784,
        3716, 4703, 4851, 4955, 5018, 4642, 4840, 4961, 4263, 5011, 4922, 4317,
        3636, 4884, 5041, 4912, 4504, 4617, 4633, 4566, 4702, 4758, 4860, 3962,
        4882, 4467, 4730, 4910, 4684, 4908, 4759, 4880, 4095, 4971, 4873, 4561,
        4588, 4773, 4997, 4583, 4900, 4574, 4629, 4676, 4181, 5057, 4944, 4401,
        4586, 4699, 3676, 4387, 4866, 4926, 4657, 4477, 4359, 4673, 4258, 4447,
        4570, 4486, 4362, 4481, 4322, 4668, 3967, 4374, 4553, 4641, 4215, 3853,
        4787, 4266, 4199, 4545, 4208, 4485, 3714, 4407, 4182, 4203, 3788, 4471,
        4691, 4281, 4410, 3953, 3465, 4801, 4278, 4546, 3779, 4115, 4193, 3372,
        3786, 3491, 3812, 3594, 4028, 3652, 4224, 4334, 3245, 3921, 3840, 3514,
        2922, 4227, 3376, 3560, 4989, 4756, 4624, 4446, 4174, 4551, 3972, 4399,
        4562, 3133, 4157, 5053, 4536, 5067, 3905, 3721, 3787, 4674, 3436, 2673,
        4834, 4456, 4056, 3804, 3672, 4205, 3348, 4152, 3883, 3473, 3669, 3455,
        2318, 2945, 2947, 3220, 4052, 2953
    };
    
    const int L1CD_idx_p[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 63
        181,  359,   72, 1110, 1480, 5034, 4622,    1, 4547,  826, 6284, 4195,
        368,    1, 4796,  523,  151,  713, 9850, 5734,   34, 6142,  190,  644,
        467, 5384,  801,  594, 4450, 9437, 4307, 5906,  378, 9448, 9432, 5849,
       5547, 9546, 9132,  403, 3766,    3,  684, 9711,  333, 6124,10216, 4251,
       9893, 9884, 4627, 4449, 9798,  985, 4272,  126,10024,  434, 1029,  561,
        289,  638, 4353, 9899, 4629,  669, 4378, 4528, 9718, 5485, 6222,  672,
       1275, 6083, 5264,10167, 1085,  194, 5012, 4938, 9356, 5057,  866,    2,
        204, 9808, 4365,  162,  367,  201,   18,  251,10167,   21,  685,   92,
       1057,    3, 5756,   14, 9979, 9569,  515,  753, 1181, 9442,  669, 4834,
        541, 9933, 6683, 4828, 9710,10170, 9629,  260,   86, 5544,  923,  257,
        507, 4572, 4491,  341,  130,   79, 1142,  448,  875,  555, 1272, 5198,
       9529, 4459,10019, 9353, 9780,  375,  503, 4507,  875, 1246,    1, 4534,
          8, 9549, 6240,   22, 5652,10069, 4796, 4980,   27,   90, 9788,  715,
       9720,  301, 5450, 5215,   13, 1147, 4855, 1190, 1267, 1302,    1, 5007,
        549,  368, 6300, 5658, 4302,  851, 4353, 9618, 9652, 1232,  109,10174,
       6178, 1851, 1299,  325,10206, 9968,10191, 5438,10080,  219,  758, 2140,
       9753, 4799,10126,  241, 1245, 1274, 1456, 9967,  235,  512, 1078, 1078,
        953, 5647,  669, 1311, 5827,   15
    };

    const int L1CO_S1_poly[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 210
        05111, 05421, 05501, 05403, 06417, 06141, 06351, 06501, 06205,
        06235, 07751, 06623, 06733, 07627, 05667, 05051, 07665, 06325,
        04365, 04745, 07633, 06747, 04475, 04225, 07063, 04423, 06651,
        04161, 07237, 04473, 05477, 06163, 07223, 06323, 07125, 07035,
        04341, 04353, 04107, 05735, 06741, 07071, 04563, 05755, 06127,
        04671, 04511, 04533, 05357, 05607, 06673, 06153, 07565, 07107,
        06211, 04321, 07201, 04451, 05411, 05141, 07041, 06637, 04577,
        05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111,
        05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111,
        05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111,
        05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111, 05111,
        05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421,
        05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421,
        05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421,
        05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421, 05421,
        05421, 05421, 05421, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403,
        05403, 05403, 05403, 05403, 05403, 05403, 05403, 05403, 06501,
        06501, 06501, 06501, 06501, 06501, 06501, 06501, 06501, 06501,
        06501, 06501, 06501
    };

    const int L1CO_S1_init[GPS_L1C_NUMBER_OF_CODES] = { // PRN 1 - 210
        03266, 02040, 01527, 03307, 03756, 03026, 00562, 00420, 03415,
        00337, 00265, 01230, 02204, 01440, 02412, 03516, 02761, 03750,
        02701, 01206, 01544, 01774, 00546, 02213, 03707, 02051, 03650,
        01777, 03203, 01762, 02100, 00571, 03710, 03535, 03110, 01426,
        00255, 00321, 03124, 00572, 01736, 03306, 01307, 03763, 01604,
        01021, 02624, 00406, 00114, 00077, 03477, 01000, 03460, 02607,
        02057, 03467, 00706, 02032, 01464, 00520, 01766, 03270, 00341,
        01740, 03664, 01427, 02627, 00701, 03460, 01373, 02540, 02004,
        02274, 01340, 00602, 02502, 00327, 02600, 00464, 03674, 03040,
        01153, 00747, 01770, 03772, 01731, 01672, 01333, 02705, 02713,
        03562, 03245, 03770, 03202, 03521, 03250, 02117, 00530, 03021,
        02511, 01562, 01067, 00424, 03402, 01326, 02142, 00733, 00504,
        01611, 02724, 00753, 03724, 02652, 01743, 00013, 03464, 02300,
        01334, 02175, 02564, 03075, 03455, 03627, 00617, 01324, 03506,
        02231, 01110, 01271, 03740, 03652, 01644, 03635, 03436, 03076,
        00434, 03340, 00054, 02446, 00025, 00150, 02746, 02723, 02601,
        03440, 01312, 00544, 02062, 00176, 03616, 01740, 03777, 00432,
        02466, 01667, 03601, 02706, 02022, 01363, 02331, 03556, 02205,
        03734, 02115, 00010, 02140, 03136, 00272, 03264, 02017, 02505,
        03532, 00647, 01542, 02154, 03734, 02621, 02711, 00217, 03503,
        03457, 03750, 02525, 00113, 00265, 01711, 00552, 00675, 01706,
        03513, 01135, 00566, 00500, 00254, 03445, 02542, 01257, 00211,
        00534, 01420, 03401, 00714, 00613, 02475, 02572, 03265, 01250,
        01711, 02704, 00135
    };

    const int L1CO_S2_init[GPS_L1C_NUMBER_OF_CODES] = { // PRN 64 - 210
        03035, 01557, 00237, 02527, 03307, 01402, 01225, 00607, 00351,
        03724, 01675, 02625, 01030, 01443, 03277, 01132, 00572, 01241,
        00535, 01366, 00041, 00561, 00122, 01205, 03753, 02543, 03031,
        02260, 03773, 03156, 02215, 00146, 02413, 02564, 03310, 02267,
        03120, 00064, 01042, 00476, 01020, 00431, 00216, 02736, 02527,
        02431, 01013, 00524, 00726, 01042, 03362, 01364, 03354, 00623,
        00145, 00214, 00223, 00151, 02405, 02522, 03235, 00452, 02617,
        01300, 01430, 00773, 00772, 03561, 00607, 00420, 00527, 03770,
        02536, 02233, 03366, 03766, 03554, 02060, 02070, 00713, 03366,
        03247, 02776, 01244, 02102, 01712, 01245, 03344, 01277, 00165,
        02131, 03623, 00141, 00421, 03032, 02065, 03024, 02663, 02274,
        02114, 01664, 00413, 01512, 00135, 02737, 01015, 01075, 01255,
        03473, 02716, 00101, 01105, 01407, 03407, 01046, 03237, 00154,
        03010, 02245, 02051, 02144, 01743, 02511, 03410, 01414, 01275,
        02257, 02331, 00276, 03261, 01760, 00430, 03477, 01676, 01636,
        02411, 01473, 02266, 02104, 02070, 01766, 00711, 02533, 00353,
        01744, 00053, 02222
    };
   

};